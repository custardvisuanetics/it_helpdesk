<!doctype html>
<html>
<head><title>Update Ticket</title></head>
<body>
    <h1>Update Ticket #{{ ticket.id }}</h1>
    <form method="post">
        <label>Status:
            <select name="status">
                <option {% if ticket.status == 'Open' %}selected{% endif %}>Open</option>
                <option {% if ticket.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                <option {% if ticket.status == 'Closed' %}selected{% endif %}>Closed</option>
            </select>
        </label><br>
        {% if g.role == 'admin' %}
        <label>Assign to:
            <select name="assigned_to">
                <option value="" {% if not ticket.assigned_to %}selected{% endif %}>(Unassigned)</option>
                {% for tech in technicians %}
                    <option value="{{ tech.username }}" {% if ticket.assigned_to == tech.username %}selected{% endif %}>
                        {{ tech.username }}{% if tech.username == g.user and g.role == 'admin' %} (You - Admin){% endif %}
                    </option>
                {% endfor %}
            </select>
        </label><br><br>
        {% elif g.role == 'technician' %}
            {% if not ticket.assigned_to %}
                <p>This ticket is currently <strong>unassigned</strong>.</p>
                <label>
                    <input type="checkbox" name="assign_self" value="yes"> Assign to me ({{ g.user }})
                    </label><br><br>
                {% else %}
                    <p>This ticket is assigned to <strong>{{ ticket.assigned_to }}</strong>.</p>
                {% endif %}
        {% endif %}
        <input type="submit" value="Update">
    </form>
    <a href="{{ url_for('index') }}">Back to Home</a>
</body>
</html>
